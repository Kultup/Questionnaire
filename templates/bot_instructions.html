{% extends "base.html" %}

{% block title %}Інструкція з налаштування бота - SurveyBridge{% endblock %}

{% block extra_css %}
<style>
    .instruction-card {
        border-left: 4px solid #0d6efd;
        margin-bottom: 2rem;
        transition: transform 0.2s ease-in-out;
    }
    
    .instruction-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    .step-number {
        background: linear-gradient(135deg, #0d6efd, #6610f2);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 1rem;
        flex-shrink: 0;
    }
    
    .code-block {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 0.375rem;
        padding: 1rem;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        margin: 1rem 0;
        position: relative;
    }
    
    .copy-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
        padding: 0.25rem;
        border-radius: 0.25rem;
    }
    
    .copy-btn:hover {
        background-color: #e9ecef;
        color: #495057;
    }
    
    .warning-box {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 0.375rem;
        padding: 1rem;
        margin: 1rem 0;
    }
    
    .success-box {
        background-color: #d1edff;
        border: 1px solid #b6d7ff;
        border-radius: 0.375rem;
        padding: 1rem;
        margin: 1rem 0;
    }
    
    .screenshot-placeholder {
        background-color: #f8f9fa;
        border: 2px dashed #dee2e6;
        border-radius: 0.375rem;
        padding: 2rem;
        text-align: center;
        color: #6c757d;
        margin: 1rem 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-3">
        <div class="col-12">
            <a href="{{ url_for('user_dashboard') }}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-2"></i>Повернутися на головну
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="d-flex align-items-center mb-4">
            <i class="fas fa-robot text-primary me-3" style="font-size: 2rem;"></i>
            <div>
                <h1 class="mb-0">Інструкція з налаштування Telegram бота</h1>
                <p class="text-muted mb-0">Покрокове керівництво для створення та налаштування бота для збору відгуків</p>
            </div>
        </div>
    </div>
</div>

<!-- Швидка навігація -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-list me-2"></i>Швидка навігація</h5>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li><a href="#step1" class="text-decoration-none"><i class="fas fa-chevron-right me-2"></i>Крок 1: Створення бота</a></li>
                            <li><a href="#step2" class="text-decoration-none"><i class="fas fa-chevron-right me-2"></i>Крок 2: Отримання токена</a></li>
                            <li><a href="#step3" class="text-decoration-none"><i class="fas fa-chevron-right me-2"></i>Крок 3: Створення групи</a></li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li><a href="#step4" class="text-decoration-none"><i class="fas fa-chevron-right me-2"></i>Крок 4: Додавання бота в групу</a></li>
                            <li><a href="#step5" class="text-decoration-none"><i class="fas fa-chevron-right me-2"></i>Крок 5: Налаштування в системі</a></li>
                            <li><a href="#step6" class="text-decoration-none"><i class="fas fa-chevron-right me-2"></i>Крок 6: Керування групою</a></li>
                            <li><a href="#troubleshooting" class="text-decoration-none"><i class="fas fa-chevron-right me-2"></i>Вирішення проблем</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Крок 1: Створення бота -->
<div class="row mb-4" id="step1">
    <div class="col-12">
        <div class="card instruction-card">
            <div class="card-body">
                <div class="d-flex align-items-start">
                    <div class="step-number">1</div>
                    <div class="flex-grow-1">
                        <h4 class="card-title">Створення Telegram бота</h4>
                        <p class="card-text">Для початку роботи потрібно створити бота через офіційний BotFather в Telegram.</p>
                        
                        <ol>
                            <li>Відкрийте Telegram та знайдіть <strong>@BotFather</strong></li>
                            <li>Натисніть <code>/start</code> для початку роботи</li>
                            <li>Введіть команду <code>/newbot</code> для створення нового бота</li>
                            <li>Введіть ім'я для вашого бота (наприклад: "testbotuser10009")</li>
                            <li>Введіть username для бота (має закінчуватися на "bot", наприклад: "testbotuser10009_bot")</li>
                        </ol>
                        
                        <div class="info-box">
                            <i class="fas fa-info-circle text-info me-2"></i>
                            <strong>Детальний процес створення:</strong>
                            <ol class="mt-2 mb-0">
                                <li><strong>Команда /newbot:</strong> BotFather запитає "Alright, a new bot. How are we going to call it? Please choose a name for your bot."</li>
                                <li><strong>Назва бота:</strong> Введіть будь-яку назву (наприклад: "testbotuser10009")</li>
                                <li><strong>Username бота:</strong> BotFather запитає "Good. Now let's choose a username for your bot. It must end in 'bot'. Like this, for example: TetrisBot or tetris_bot."</li>
                                <li><strong>Фінальний username:</strong> Введіть username з закінченням "_bot" (наприклад: "testbotuser10009_bot")</li>
                            </ol>
                        </div>
                        
                        <div class="warning-box">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                            <strong>Важливо:</strong> Username бота має бути унікальним та закінчуватися на "bot"
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Крок 2: Отримання токена -->
<div class="row mb-4" id="step2">
    <div class="col-12">
        <div class="card instruction-card">
            <div class="card-body">
                <div class="d-flex align-items-start">
                    <div class="step-number">2</div>
                    <div class="flex-grow-1">
                        <h4 class="card-title">Отримання токена бота</h4>
                        <p class="card-text">Після створення бота BotFather надасть вам токен для доступу до API.</p>
                        
                        <div class="success-box">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <strong>Успішне створення бота!</strong> Після введення правильного username, BotFather надішле вам повідомлення:
                            <div class="mt-2 p-2 bg-dark text-light rounded">
                                <small>
                                    <strong>Done! Congratulations on your new bot. You will find it at t.me/testbotuser10009_bot. You can now add a description, about section and profile picture for your bot, see /help for a list of commands. By the way, when you've finished creating your cool bot, ping our Bot Support if you want a better username for it. Just make sure the bot is fully operational before you do this.</strong>
                                </small>
                            </div>
                        </div>
                        
                        <div class="success-box">
                            <i class="fas fa-key text-success me-2"></i>
                            <strong>Токен для доступу до HTTP API:</strong><br>
                            <small class="text-muted">BotFather надасть вам токен у такому форматі:</small>
                            <div class="mt-2 p-2 bg-dark text-light rounded">
                                <small><strong>Use this token to access the HTTP API:</strong></small><br>
                                <code class="user-select-all text-warning">8221493825:AAHgB_HXt8XJF031AtN6LUH4IqCUCp-s_mI</code>
                            </div>
                            <small class="text-muted mt-1 d-block">Скопіюйте цей токен - він знадобиться для налаштування системи</small>
                        </div>
                        
                        <div class="warning-box">
                            <i class="fas fa-shield-alt text-warning me-2"></i>
                            <strong>Важливо про безпеку:</strong> 
                            <ul class="mb-0 mt-2">
                                <li>Тримайте токен у секреті!</li>
                                <li>Він дає повний доступ до вашого бота</li>
                                <li>Ніколи не публікуйте його у відкритому доступі</li>
                                <li>Зберігайте токен безпечно, як пароль</li>
                            </ul>
                        </div>
                        
                        <div class="success-box">
                            <i class="fas fa-book text-info me-2"></i>
                            <strong>Документація Bot API:</strong> Детальну інформацію про можливості API можна знайти за посиланням: <a href="https://core.telegram.org/bots/api" target="_blank" class="text-decoration-none">https://core.telegram.org/bots/api</a>
                        </div>
                        
                        <p><strong>Додаткові налаштування бота:</strong></p>
                        <ul>
                            <li>Встановіть опис бота: <code>/setdescription</code></li>
                            <li>Встановіть аватар: <code>/setuserpic</code></li>
                            <li>Встановіть команди: <code>/setcommands</code></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Крок 3: Створення групи -->
<div class="row mb-4" id="step3">
    <div class="col-12">
        <div class="card instruction-card">
            <div class="card-body">
                <div class="d-flex align-items-start">
                    <div class="step-number">3</div>
                    <div class="flex-grow-1">
                        <h4 class="card-title">Створення Telegram групи</h4>
                        <p class="card-text">Створіть групу, куди будуть надходити відгуки від користувачів.</p>
                        
                        <ol>
                            <li>У Telegram натисніть на іконку "Нова група" або "New Group"</li>
                            <li>Додайте учасників групи (адміністраторів, які будуть обробляти відгуки)</li>
                            <li>Введіть назву групи (наприклад: "Відгуки клієнтів")</li>
                            <li>Створіть групу</li>
                        </ol>
                        
                        <div class="success-box">
                            <i class="fas fa-lightbulb text-info me-2"></i>
                            <strong>Порада:</strong> Рекомендується створити окрему групу спеціально для відгуків, щоб не змішувати їх з іншими повідомленнями.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Крок 4: Додавання бота в групу -->
<div class="row mb-4" id="step4">
    <div class="col-12">
        <div class="card instruction-card">
            <div class="card-body">
                <div class="d-flex align-items-start">
                    <div class="step-number">4</div>
                    <div class="flex-grow-1">
                        <h4 class="card-title">Додавання бота в групу</h4>
                        <p class="card-text">Додайте створеного бота в групу та надайте йому необхідні права.</p>
                        
                        <ol>
                            <li>Відкрийте створену групу</li>
                            <li>Натисніть на назву групи вгорі</li>
                            <li>Виберіть "Додати учасника" або "Add Member"</li>
                            <li>Знайдіть вашого бота за username (наприклад: @feedback_system_bot)</li>
                            <li>Додайте бота в групу</li>
                            <li>Надайте боту права адміністратора з можливістю відправляти повідомлення</li>
                        </ol>
                        
                        <div class="warning-box">
                            <i class="fas fa-user-shield text-warning me-2"></i>
                            <strong>Права бота:</strong> Бот повинен мати права на відправку повідомлень в групу. Переконайтеся, що він має статус адміністратора або учасника з відповідними правами.
                        </div>
                        
                        <h5 class="mt-3">Приклад налаштування прав адміністратора</h5>
                        <p>Ось як виглядає інтерфейс налаштування прав для бота в Telegram:</p>
                        
                        <div class="text-center my-3">
                            <img src="{{ url_for('static', filename='css/admin-rights-example.svg') }}" 
                                 alt="Приклад прав адміністратора в Telegram" 
                                 class="img-fluid border rounded" 
                                 style="max-width: 400px;">
                        </div>
                        
                        <div class="success-box">
                            <i class="fas fa-lightbulb text-info me-2"></i>
                            <strong>Рекомендовані права для бота:</strong>
                            <ul class="mb-0 mt-2">
                                <li>✅ <strong>Видалення повідомлень</strong> - для керування контентом</li>
                                <li>✅ <strong>Закріплення повідомлень</strong> - для важливих оголошень</li>
                                <li>❌ <strong>Анонімність</strong> - краще залишити вимкненою</li>
                                <li>❌ <strong>Додавання адміністраторів</strong> - не потрібно для бота</li>
                            </ul>
                        </div>
                        
                        <h5 class="mt-3">Отримання Chat ID групи</h5>
                        <p>Для налаштування системи потрібно дізнатися Chat ID групи:</p>
                        <ol>
                            <li>Додайте бота <strong>@userinfobot</strong> в групу</li>
                            <li>Напишіть в групі <code>/start</code></li>
                            <li>Бот покаже інформацію про групу, включаючи Chat ID</li>
                            <li>Chat ID групи зазвичай починається з мінуса (наприклад: -1001234567890)</li>
                            <li>Збережіть цей ID - він знадобиться для налаштування</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Крок 5: Налаштування в системі -->
<div class="row mb-4" id="step5">
    <div class="col-12">
        <div class="card instruction-card">
            <div class="card-body">
                <div class="d-flex align-items-start">
                    <div class="step-number">5</div>
                    <div class="flex-grow-1">
                        <h4 class="card-title">Налаштування в системі відгуків</h4>
                        <p class="card-text">Введіть отримані дані в налаштування системи.</p>
                        
                        <ol>
                            <li>Перейдіть на сторінку <a href="{{ url_for('user_bot_settings') }}" class="text-decoration-none">Налаштування бота</a></li>
                            <li>Введіть токен бота в поле "Bot Token"</li>
                            <li>Введіть Chat ID групи в поле "Chat ID"</li>
                            <li>Натисніть "Зберегти налаштування"</li>
                            <li>Протестуйте роботу, натиснувши "Тестове повідомлення"</li>
                        </ol>
                        
                        <div class="success-box">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Якщо все налаштовано правильно, тестове повідомлення з'явиться в вашій Telegram групі.
                        </div>
                        
                        <div class="code-block">
                            <strong>Приклад налаштувань:</strong><br>
                            Bot Token: 1234567890:ABCdefGHIjklMNOpqrSTUvwxYZ1234567890<br>
                            Chat ID: -1001234567890
                        </div>
                        
                        <h5 class="mt-4">Керування статусом групи</h5>
                        <p>Тепер ви можете легко керувати відправкою повідомлень в Telegram групу:</p>
                        <ul>
                            <li><strong>Увімкнути групу:</strong> Відгуки будуть автоматично надсилатися в Telegram групу</li>
                            <li><strong>Вимкнути групу:</strong> Відгуки не будуть надсилатися в групу, але налаштування збережуться</li>
                        </ul>
                        
                        <div class="warning-box">
                            <i class="fas fa-info-circle text-info me-2"></i>
                            <strong>Зверніть увагу:</strong> При вимкненні групи ваші налаштування (токен та Chat ID) залишаються збереженими. Ви можете в будь-який момент знову увімкнути відправку повідомлень.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Крок 6: Керування групою -->
<div class="row mb-4" id="step6">
    <div class="col-12">
        <div class="card instruction-card">
            <div class="card-body">
                <div class="d-flex align-items-start">
                    <div class="step-number">6</div>
                    <div class="flex-grow-1">
                        <h4 class="card-title">Керування Telegram групою</h4>
                        <p class="card-text">Гнучке керування відправкою повідомлень в групу.</p>
                        
                        <h5>Увімкнення групи</h5>
                        <ol>
                            <li>Перейдіть на сторінку <a href="{{ url_for('user_bot_settings') }}" class="text-decoration-none">Налаштування бота</a></li>
                            <li>Переконайтеся, що введені правильні токен та Chat ID</li>
                            <li>Увімкніть перемикач "Увімкнути Telegram групу"</li>
                            <li>Натисніть "Зберегти налаштування"</li>
                        </ol>
                        
                        <h5 class="mt-3">Тимчасове вимкнення групи</h5>
                        <p>Якщо вам потрібно тимчасово припинити відправку повідомлень:</p>
                        <ol>
                            <li>Перейдіть на сторінку налаштувань бота</li>
                            <li>Вимкніть перемикач "Увімкнути Telegram групу"</li>
                            <li>Натисніть "Зберегти налаштування"</li>
                        </ol>
                        
                        <div class="success-box">
                            <i class="fas fa-lightbulb text-info me-2"></i>
                            <strong>Переваги:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Швидке увімкнення/вимкнення без втрати налаштувань</li>
                                <li>Можливість тестування без спаму в групу</li>
                                <li>Гнучке керування в залежності від потреб</li>
                            </ul>
                        </div>
                        
                        <h5 class="mt-3">Статуси групи</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card border-success">
                                    <div class="card-body text-center">
                                        <i class="fas fa-check-circle text-success" style="font-size: 2rem;"></i>
                                        <h6 class="mt-2">Група увімкнена</h6>
                                        <small class="text-muted">Відгуки надсилаються в Telegram</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-warning">
                                    <div class="card-body text-center">
                                        <i class="fas fa-pause-circle text-warning" style="font-size: 2rem;"></i>
                                        <h6 class="mt-2">Група вимкнена</h6>
                                        <small class="text-muted">Відгуки не надсилаються</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Вирішення проблем -->
<div class="row mb-4" id="troubleshooting">
    <div class="col-12">
        <div class="card instruction-card">
            <div class="card-body">
                <div class="d-flex align-items-start">
                    <div class="step-number"><i class="fas fa-tools"></i></div>
                    <div class="flex-grow-1">
                        <h4 class="card-title">Вирішення проблем</h4>
                        
                        <div class="accordion" id="troubleshootingAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#problem1">
                                        Бот не відправляє повідомлення в групу
                                    </button>
                                </h2>
                                <div id="problem1" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                    <div class="accordion-body">
                                        <ul>
                                            <li>Перевірте, чи правильно введений токен бота</li>
                                            <li>Переконайтеся, що бот додан в групу</li>
                                            <li>Перевірте, чи має бот права на відправку повідомлень</li>
                                            <li>Переконайтеся, що Chat ID групи введений правильно (з мінусом)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#problem2">
                                        Помилка "Bot token is invalid"
                                    </button>
                                </h2>
                                <div id="problem2" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                    <div class="accordion-body">
                                        <ul>
                                            <li>Перевірте, чи правильно скопійований токен (без зайвих пробілів)</li>
                                            <li>Переконайтеся, що токен не застарів</li>
                                            <li>Спробуйте створити новий токен через BotFather командою <code>/token</code></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#problem3">
                                        Не можу знайти Chat ID групи
                                    </button>
                                </h2>
                                <div id="problem3" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                    <div class="accordion-body">
                                        <ul>
                                            <li>Додайте бота @userinfobot в групу</li>
                                            <li>Напишіть <code>/start</code> в групі</li>
                                            <li>Альтернативно, додайте бота @chatid_echo_bot</li>
                                            <li>Chat ID групи завжди починається з мінуса</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#problem4">
                                        Група вимкнена, але налаштування збережені
                                    </button>
                                </h2>
                                <div id="problem4" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                    <div class="accordion-body">
                                        <p>Це нормальна поведінка системи. Коли група вимкнена:</p>
                                        <ul>
                                            <li>Відгуки не надсилаються в Telegram групу</li>
                                            <li>Токен бота та Chat ID залишаються збереженими</li>
                                            <li>Ви можете в будь-який момент увімкнути групу знову</li>
                                            <li>Для увімкнення просто активуйте перемикач "Увімкнути Telegram групу"</li>
                                        </ul>
                                        <div class="alert alert-info mt-2">
                                            <i class="fas fa-info-circle me-2"></i>
                                            Це дозволяє гнучко керувати відправкою повідомлень без втрати налаштувань.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Корисні посилання -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-external-link-alt me-2"></i>Корисні посилання</h5>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li><a href="https://t.me/BotFather" target="_blank" class="text-decoration-none"><i class="fab fa-telegram me-2"></i>BotFather (створення ботів)</a></li>
                            <li><a href="https://t.me/userinfobot" target="_blank" class="text-decoration-none"><i class="fab fa-telegram me-2"></i>UserInfoBot (отримання Chat ID)</a></li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li><a href="{{ url_for('user_bot_settings') }}" class="text-decoration-none"><i class="fas fa-cog me-2"></i>Налаштування бота</a></li>
                            <li><a href="{{ url_for('user_dashboard') }}" class="text-decoration-none"><i class="fas fa-tachometer-alt me-2"></i>Панель управління</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function copyToClipboard(button) {
    const codeBlock = button.parentElement;
    const text = codeBlock.textContent.replace(button.textContent, '').trim();
    
    navigator.clipboard.writeText(text).then(function() {
        const originalIcon = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check text-success"></i>';
        
        setTimeout(function() {
            button.innerHTML = originalIcon;
        }, 2000);
    }).catch(function(err) {
        console.error('Помилка копіювання: ', err);
    });
}

// Плавна прокрутка до якорів
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});
</script>
{% endblock %}